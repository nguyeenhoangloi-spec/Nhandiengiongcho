{% extends 'base_dashboard.html' %}
{% block title %}C√†i ƒê·∫∑t{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/settings.css') }}" />
{% endblock %}

{% block content %}

<div class="page-header-pro">
  <div class="header-content">
    <h1><i class="icon">‚öôÔ∏è</i> C√†i ƒê·∫∑t</h1>
    <p>T√πy ch·ªânh tr·∫£i nghi·ªám s·ª≠ d·ª•ng c·ªßa b·∫°n</p>
  </div>
</div>

<div class="settings-container">
  <form method="POST" class="settings-form">
    <!-- Profile Section -->
    <div class="settings-section">
      <div class="section-header">
        <h3><i class="icon">üë§</i> Th√¥ng Tin C√° Nh√¢n</h3>
      </div>
      <div class="section-content">
        <div class="form-group-pro">
          <label>T√™n ƒëƒÉng nh·∫≠p</label>
          <input
            type="text"
            value="{{ session.get('username', '') }}"
            disabled
            class="input-pro"
          />
          <small class="input-hint">Kh√¥ng th·ªÉ thay ƒë·ªïi t√™n ƒëƒÉng nh·∫≠p</small>
        </div>
      </div>
    </div>

    <!-- Appearance Section -->
    <div class="settings-section">
      <div class="section-header">
        <h3><i class="icon">üé®</i> Giao Di·ªán</h3>
      </div>
      <div class="section-content">
        <div class="form-group-pro">
          <label for="theme">Theme</label>
          <select name="theme" id="theme" class="select-pro">
            <option value="light" {{ 'selected' if settings.theme == 'light' else '' }}>S√°ng</option>
            <option value="dark" {{ 'selected' if settings.theme == 'dark' else '' }}>T·ªëi</option>
            <option value="auto" {{ 'selected' if settings.theme == 'auto' else '' }}>T·ª± ƒë·ªông</option>
          </select>
          <small class="input-hint">Ch·ªçn theme hi·ªÉn th·ªã cho giao di·ªán</small>
        </div>

        <div class="form-group-pro">
          <label for="language">Ng√¥n ng·ªØ</label>
          <select name="language" id="language" class="select-pro">
            <option value="vi" {{ 'selected' if settings.language == 'vi' else '' }}>Ti·∫øng Vi·ªát</option>
            <option value="en" {{ 'selected' if settings.language == 'en' else '' }}>English</option>
          </select>
          <small class="input-hint">Ng√¥n ng·ªØ hi·ªÉn th·ªã</small>
        </div>
      </div>
    </div>

    <!-- Notifications Section -->
    <div class="settings-section">
      <div class="section-header">
        <h3><i class="icon">üîî</i> Th√¥ng B√°o</h3>
      </div>
      <div class="section-content">
        <div class="toggle-group">
          <div class="toggle-item">
            <div class="toggle-info">
              <label>Th√¥ng b√°o trong ·ª©ng d·ª•ng</label>
              <small>Hi·ªÉn th·ªã th√¥ng b√°o khi c√≥ ho·∫°t ƒë·ªông m·ªõi</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" name="notifications" {{ 'checked' if settings.notifications else '' }} />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-item">
            <div class="toggle-info">
              <label>Th√¥ng b√°o qua Email</label>
              <small>Nh·∫≠n email v·ªÅ c√°c c·∫≠p nh·∫≠t quan tr·ªçng</small>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" name="email_notifications" {{ 'checked' if settings.email_notifications else '' }} />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Privacy Section -->
    <div class="settings-section">
      <div class="section-header">
        <h3><i class="icon">üîí</i> B·∫£o M·∫≠t & Quy·ªÅn Ri√™ng T∆∞</h3>
      </div>
      <div class="section-content">
        <div class="info-box info-warning">
          <i class="icon">‚ö†Ô∏è</i>
          <div>
            <strong>L∆∞u √Ω v·ªÅ d·ªØ li·ªáu</strong>
            <p>
              ·∫¢nh v√† k·∫øt qu·∫£ nh·∫≠n di·ªán c·ªßa b·∫°n ƒë∆∞·ª£c l∆∞u tr·ªØ ƒë·ªÉ c·∫£i thi·ªán tr·∫£i
              nghi·ªám. B·∫°n c√≥ th·ªÉ x√≥a l·ªãch s·ª≠ b·∫•t c·ª© l√∫c n√†o.
            </p>
          </div>
        </div>

        <div class="action-buttons-group">
          <a href="{{ url_for('history.history') }}" class="btn-outline">
            <i class="icon">üìö</i> Xem L·ªãch S·ª≠
          </a>
          <button
            type="submit"
            class="btn-danger"
            formaction="{{ url_for('settings.clear_history') }}"
            formmethod="POST"
            onclick="return confirmClearHistory(event)"
          >
            <i class="icon">üóëÔ∏è</i> X√≥a L·ªãch S·ª≠
          </button>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="settings-actions">
      <button type="submit" class="btn-gradient-large">
        <i class="icon">üíæ</i> L∆∞u Thay ƒê·ªïi
      </button>
      <a href="{{ url_for('dashboard.dashboard') }}" class="btn-outline-large">
        <i class="icon">‚ùå</i> H·ªßy
      </a>
    </div>
  </form>
</div>

<script>
  // Theme change handler - sync with localStorage
  document.getElementById('theme').addEventListener('change', function() {
    const theme = this.value;
    // Save to localStorage for early loading
    try {
      localStorage.setItem('theme', theme);
    } catch(e) {}
    // Apply immediately to html element
    document.documentElement.setAttribute('data-theme', theme);
  });

  function confirmClearHistory(e) {
    const ok = confirm(
      "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ nh·∫≠n di·ªán? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!",
    );
    if (!ok) {
      if (e) e.preventDefault();
      return false;
    }
    return true;
  }
</script>

{% endblock %}
