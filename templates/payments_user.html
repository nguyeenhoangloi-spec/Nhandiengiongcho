{% extends "base_dashboard.html" %} {% block title %}Lịch sử thanh toán{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/users.css') }}"
/>
{% endblock %} {% block content %}
<section class="users-container">
  <div class="users-header">
    <h1><i class="fa-solid fa-receipt"></i> Lịch sử thanh toán</h1>
    <div style="color: var(--text-secondary)">Các đơn bạn đã tạo (demo)</div>
  </div>

  {# Hiển thị gói hiện tại và hạn sử dụng #}
  <div style="margin-bottom: 1.5rem">
    <div style="font-weight: bold; font-size: 1.1rem">
      Gói hiện tại:
      <span style="color: var(--primary)">
        {{ quota_info.plan|upper if quota_info and quota_info.plan else 'FREE'
        }}
      </span>
      {% if quota_info and quota_info.plan_expire %} (Hạn sử dụng:
      <span style="color: var(--accent)"
        >{{ quota_info.plan_expire.strftime('%d/%m/%Y %H:%M') }}</span
      >) {% elif quota_info and quota_info.plan != 'free' %} (Không xác định
      hạn) {% endif %}
    </div>
  </div>

  <div class="users-table-wrapper">
    <table class="users-table">
      <thead>
        <tr>
          <th>Order</th>
          <th>Gói</th>
          <th>Phương thức</th>
          <th>Số tiền</th>
          <th>Trạng thái</th>
          <th>Tạo lúc</th>
          <th>Xác nhận</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td><strong>{{ o.order_id }}</strong></td>
          <td>{{ (o.plan or '').upper() }}</td>
          <td>{{ (o.payment_method or '').upper() }}</td>
          <td>{{ o.amount_vnd }} VND</td>
          <td>
            <span
              class="status-badge {{ 'status-badge-active' if o.status == 'paid' else 'status-badge-inactive' }}"
            >
              {{ 'PAID' if o.status == 'paid' else (o.status or 'PENDING') |
              upper }}
            </span>
          </td>
          <td>{{ o.created_at }}</td>
          <td>{{ o.confirmed_at or '-' }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" style="text-align: center; padding: 1rem">
            Bạn chưa có đơn thanh toán nào.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div style="margin-top: var(--space-5)">
    <a class="nav-item" href="{{ url_for('predict.upgrade') }}">
      <i class="fa-solid fa-crown"></i> Nâng cấp gói
    </a>
  </div>
</section>
{% endblock %}
