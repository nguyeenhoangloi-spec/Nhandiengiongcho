{% extends 'base_dashboard.html' %} {% block title %}Xem Qu·∫£ng C√°o{% endblock %}
{% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/monetization.css') }}"
/>
{% endblock %} {% block content %}
<div class="page-header monetization-header">
  <h1>üì∫ Xem qu·∫£ng c√°o ƒë·ªÉ ti·∫øp t·ª•c</h1>
  <p>
    Sau 10 l∆∞·ª£t mi·ªÖn ph√≠, m·ªói qu·∫£ng c√°o s·∫Ω m·ªü kh√≥a th√™m 3 l∆∞·ª£t nh·∫≠n di·ªán (t·ªëi ƒëa
    3 l·∫ßn).
  </p>
</div>

<div class="monetization-card">
  <div class="monetization-status">
    {% if quota_info %}
    <div class="status-row">
      <span class="status-badge"
        >ƒê√£ nh·∫≠n di·ªán: {{ quota_info.total_predictions }}/{{
        quota_info.free_limit }}</span
      >
      <span class="status-badge"
        >Unlock c√≤n: {{ quota_info.ad_unlocks_remaining }}</span
      >
      <span class="status-badge"
        >Ads: {{ quota_info.ad_views_used }}/{{ quota_info.ad_views_limit
        }}</span
      >
    </div>
    {% endif %}
  </div>

  <div class="ad-player" id="adPlayer">
    <div class="ad-placeholder">
      <div class="ad-title">Video qu·∫£ng c√°o (demo)</div>
      <div class="ad-sub">
        Vui l√≤ng ch·ªù <span id="countdown">8</span>s ƒë·ªÉ m·ªü kh√≥a
      </div>
      <div class="ad-bar"><span id="adBar"></span></div>
    </div>
  </div>

  <form
    method="post"
    action="{{ url_for('predict.watch_ad_complete') }}"
    class="ad-actions"
  >
    <a class="btn-outline" href="{{ url_for('predict.upload_page') }}"
      >Quay l·∫°i</a
    >
    <button class="btn-primary" type="submit" id="completeBtn" disabled>
      ‚úÖ T√¥i ƒë√£ xem xong
    </button>
  </form>

  <div class="ad-note">
    N·∫øu b·∫°n ƒë√£ xem ƒë·ªß 3 l·∫ßn, h·ªá th·ªëng s·∫Ω y√™u c·∫ßu mua g√≥i ƒë·ªÉ s·ª≠ d·ª•ng ti·∫øp.
  </div>
</div>

<script>
  (function () {
    const total = 8;
    let remaining = total;
    const countdownEl = document.getElementById("countdown");
    const btn = document.getElementById("completeBtn");
    const bar = document.getElementById("adBar");

    function tick() {
      remaining -= 1;
      if (remaining <= 0) {
        countdownEl.textContent = "0";
        btn.disabled = false;
        btn.classList.add("ready");
        bar.style.width = "100%";
        return;
      }
      countdownEl.textContent = String(remaining);
      const progress = ((total - remaining) / total) * 100;
      bar.style.width = progress.toFixed(0) + "%";
      setTimeout(tick, 1000);
    }

    bar.style.width = "0%";
    setTimeout(tick, 1000);
  })();
</script>
{% endblock %}
