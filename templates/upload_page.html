{% extends 'base_dashboard.html' %} {% block title %}Nháº­n Diá»‡n Giá»‘ng ChÃ³{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/upload.css') }}"
/>
{% endblock %} {% block content %}
<div class="page-header">
  <h1>ğŸ“¸ Nháº­n Diá»‡n Giá»‘ng ChÃ³</h1>
  <p>
    Táº£i lÃªn áº£nh chÃ³ cá»§a báº¡n Ä‘á»ƒ AI phÃ¢n tÃ­ch vÃ  nháº­n diá»‡n giá»‘ng tá»« 120 giá»‘ng
    trong database
  </p>
</div>

{% if quota_info and quota_info.plan == 'free' %}
<div class="quota-banner">
  <div class="quota-row">
    <div class="quota-title">GÃ³i hiá»‡n táº¡i: {{ quota_info.plan|upper }}</div>
    <div class="quota-badges">
      <span class="quota-badge"
        >Free: {{ quota_info.total_predictions }}/{{ quota_info.free_limit
        }}</span
      >
      <span class="quota-badge"
        >CÃ²n {{ quota_info.remaining_free }} lÆ°á»£t miá»…n phÃ­</span
      >
      <span class="quota-badge"
        >Unlock: {{ quota_info.ad_unlocks_remaining }}</span
      >
      <span class="quota-badge"
        >Ads: {{ quota_info.ad_views_used }}/{{ quota_info.ad_views_limit
        }}</span
      >
    </div>
  </div>
  {% if quota_info.remaining_free <= 0 %}
  <div class="quota-hint">
    Háº¿t lÆ°á»£t miá»…n phÃ­: hÃ£y
    <a href="{{ url_for('predict.watch_ad') }}">xem quáº£ng cÃ¡o</a> Ä‘á»ƒ má»Ÿ khÃ³a
    thÃªm.
  </div>
  {% endif %}
</div>
{% elif quota_info and quota_info.plan in ['pro', 'enterprise', 'basic'] %}
<div class="quota-banner">
  <div class="quota-row">
    <div class="quota-title">GÃ³i hiá»‡n táº¡i: {{ quota_info.plan|upper }}</div>
    <div class="quota-badges">
      <span class="quota-badge">KhÃ´ng giá»›i háº¡n lÆ°á»£t nháº­n diá»‡n</span>
    </div>
  </div>
</div>
{% endif %}

<div class="upload-container">
  <form
    action="{{ url_for('predict.upload') }}"
    method="post"
    enctype="multipart/form-data"
    class="card upload-form"
    id="uploadForm"
  >
    <div class="drag-drop-zone" id="dropZone">
      <div class="upload-content" id="uploadContent">
        <div class="upload-icon">ğŸ“·</div>
        <h3>KÃ©o tháº£ áº£nh vÃ o Ä‘Ã¢y</h3>
        <p class="upload-subtitle">hoáº·c</p>
        <label class="file-input-label">
          <input
            type="file"
            name="image"
            accept="image/png, image/jpeg, image/jpg"
            required
            id="imageInput"
          />
          <span>ğŸ“‚ Chá»n file tá»« mÃ¡y</span>
        </label>
        <p class="upload-hint">Há»— trá»£: JPG, PNG, JPEG (tá»‘i Ä‘a 10MB)</p>
      </div>
      <div
        class="preview-container"
        id="previewContainer"
        style="display: none"
      >
        <img id="imagePreview" class="image-preview" alt="Preview" />
        <div class="preview-actions">
          <button type="button" class="btn-change" id="changeBtn">
            ğŸ”„ Äá»•i áº£nh
          </button>
          <button type="submit" class="btn-analyze">ğŸ” PhÃ¢n TÃ­ch Ngay</button>
        </div>
      </div>
    </div>
  </form>

  <!-- Info Cards -->
  <div class="info-cards">
    <div class="info-card">
      <div class="info-icon">ğŸ¯</div>
      <h4>120+ Giá»‘ng ChÃ³</h4>
      <p>Há»‡ thá»‘ng nháº­n diá»‡n tá»« Chihuahua Ä‘áº¿n Great Dane</p>
    </div>
    <div class="info-card">
      <div class="info-icon">âš¡</div>
      <h4>Xá»­ LÃ½ Nhanh</h4>
      <p>Káº¿t quáº£ trong vÃ²ng 1-2 giÃ¢y</p>
    </div>
    <div class="info-card">
      <div class="info-icon">ğŸ“Š</div>
      <h4>Äá»™ Tin Cáº­y Cao</h4>
      <p>Hiá»ƒn thá»‹ % chÃ­nh xÃ¡c cho má»—i dá»± Ä‘oÃ¡n</p>
    </div>
  </div>
</div>

<script>
  const dropZone = document.getElementById("dropZone");
  const uploadContent = document.getElementById("uploadContent");
  const previewContainer = document.getElementById("previewContainer");
  const imageInput = document.getElementById("imageInput");
  const imagePreview = document.getElementById("imagePreview");
  const changeBtn = document.getElementById("changeBtn");

  // Drag and drop handlers
  ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
    dropZone.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ["dragenter", "dragover"].forEach((eventName) => {
    dropZone.addEventListener(
      eventName,
      () => dropZone.classList.add("drag-over"),
      false,
    );
  });

  ["dragleave", "drop"].forEach((eventName) => {
    dropZone.addEventListener(
      eventName,
      () => dropZone.classList.remove("drag-over"),
      false,
    );
  });

  dropZone.addEventListener("drop", handleDrop, false);

  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    if (files.length > 0) {
      imageInput.files = files;
      displayPreview(files[0]);
    }
  }

  imageInput.addEventListener("change", function (e) {
    if (e.target.files.length > 0) {
      displayPreview(e.target.files[0]);
    }
  });

  function displayPreview(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      imagePreview.src = e.target.result;
      uploadContent.style.display = "none";
      previewContainer.style.display = "block";
    };
    reader.readAsDataURL(file);
  }

  changeBtn.addEventListener("click", function () {
    uploadContent.style.display = "block";
    previewContainer.style.display = "none";
    imageInput.value = "";
  });
</script>

{% endblock %}
