{% extends 'base_dashboard.html' %} {% block title %}Lá»‹ch Sá»­ Nháº­n Diá»‡n{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/history.css') }}"
/>
{% endblock %} {% block content %}

<div class="page-header-pro">
  <div class="header-content">
    <h1><i class="icon">ğŸ“š</i> Lá»‹ch Sá»­ Nháº­n Diá»‡n</h1>
    <p>
      Xem láº¡i táº¥t cáº£ cÃ¡c láº§n nháº­n diá»‡n giá»‘ng chÃ³ cá»§a báº¡n ({{ total_records }}
      báº£n ghi)
    </p>
  </div>
  <div class="header-actions">
    <a href="{{ url_for('predict.upload_page') }}" class="btn-gradient">
      <i class="icon">â•</i> Nháº­n Diá»‡n Má»›i
    </a>
  </div>
</div>

{% if predictions and predictions|length > 0 %}
<div class="history-grid">
  {% for pred in predictions %}
  <div
    class="history-card"
    data-aos="fade-up"
    data-aos-delay="{{ loop.index0 * 50 }}"
  >
    <div class="history-image-container">
      <img src="/{{ pred.image_path }}" alt="Dog" class="history-image" />
      <div class="history-overlay">
        <a href="/{{ pred.image_path }}" target="_blank" class="view-full">
          <i class="icon">ğŸ”</i> Xem Ä‘áº§y Ä‘á»§
        </a>
      </div>
    </div>
    <div class="history-content">
      <div class="breed-badge">
        <div class="breed-icon">ğŸ•</div>
        <div class="breed-details">
          <div class="breed-name">{{ pred.breed or 'ChÆ°a xÃ¡c Ä‘á»‹nh' }}</div>
          {% if pred.confidence %}
          <div class="breed-confidence">
            <div class="confidence-mini-bar">
              <div
                class="confidence-fill"
                style="--progress: {{ ((pred.confidence or 0) * 100)|int }}%;"
              ></div>
            </div>
            <span class="confidence-percent"
              >{{ '%.1f'|format(pred.confidence * 100) }}%</span
            >
          </div>
          {% endif %}
        </div>
      </div>

      <div class="history-meta">
        <div class="meta-item">
          <i class="icon-small">ğŸ“…</i>
          <span>{{ pred.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
        </div>
        <div class="meta-item">
          <i class="icon-small">ğŸ·ï¸</i>
          <span>{{ pred.species or 'Dog' }}</span>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination">
  {% if page > 1 %}
  <a
    href="{{ url_for('history.history', page=page-1) }}"
    class="btn-pagination"
  >
    <i class="icon">â—€</i> TrÆ°á»›c
  </a>
  {% else %}
  <button class="btn-pagination" disabled><i class="icon">â—€</i> TrÆ°á»›c</button>
  {% endif %}

  <div class="page-numbers">
    {% for p in range(1, total_pages + 1) %} {% if p == page %}
    <span class="page-number active">{{ p }}</span>
    {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
    <a href="{{ url_for('history.history', page=p) }}" class="page-number"
      >{{ p }}</a
    >
    {% elif p == page - 3 or p == page + 3 %}
    <span class="page-ellipsis">...</span>
    {% endif %} {% endfor %}
  </div>

  {% if page < total_pages %}
  <a
    href="{{ url_for('history.history', page=page+1) }}"
    class="btn-pagination"
  >
    Sau <i class="icon">â–¶</i>
  </a>
  {% else %}
  <button class="btn-pagination" disabled>Sau <i class="icon">â–¶</i></button>
  {% endif %}
</div>

{% else %}
<div class="empty-state">
  <div class="empty-icon">ğŸ“­</div>
  <h3>ChÆ°a CÃ³ Lá»‹ch Sá»­</h3>
  <p>Báº¡n chÆ°a thá»±c hiá»‡n nháº­n diá»‡n giá»‘ng chÃ³ nÃ o. HÃ£y thá»­ ngay!</p>
  <a href="{{ url_for('predict.upload_page') }}" class="btn-gradient-large">
    <i class="icon">ğŸ“¸</i> Báº¯t Äáº§u Nháº­n Diá»‡n
  </a>
</div>
{% endif %} {% endblock %}
